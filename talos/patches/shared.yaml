machine:
  kubelet:
    extraArgs:
      rotate-server-certificates: true

  network:
    nameservers:
      - 1.1.1.1
      - 8.8.8.8
      - 1.0.0.1
      - 8.8.4.4

  install:
    # This image includes the siderolabs/tailscale extension
    image: factory.talos.dev/metal-installer-secureboot/4a0d65c669d46663f377e7161e50cfd570c401f26fd9e7bda34a0216b6f1922b:v1.10.6
    wipe: false

    disk:
      $patch: delete
    diskSelector:
      size: 240GB
      model: CT240BX500SSD

  nodeLabels:
    $patch: delete

  time:
    disabled: false
    servers:
      - time.cloudflare.com
      - time.google.com
      - 0.north-america.pool.ntp.org
      - 1.north-america.pool.ntp.org
      - 2.north-america.pool.ntp.org
      - 3.north-america.pool.ntp.org
    bootTimeout: 2m0s

  sysctls:
    kernel.domainname: talos.dev
    net/ipv6/conf/eth0.100/disable_ipv6: "1"

cluster:
  # We want the kubelet to support a proper metrics-server for kubectl top
  extraManifests:
    - https://raw.githubusercontent.com/alex1989hu/kubelet-serving-cert-approver/main/deploy/standalone-install.yaml
    - https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml
